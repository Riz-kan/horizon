<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Product Modal</title>
  <style>
    .x-handle-product-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .x-handle-product-modal.is-open {
      display: flex;
    }

    .x-handle-product-modal__backdrop {
      position: absolute;
      inset: 0;
      background: rgba(17, 24, 39, 0.5);
      backdrop-filter: blur(2px);
    }

    .x-handle-product-modal__dialog {
      position: relative;
      background: #ffffff;
      color: #111827;
      border-radius: 12px;
      padding: 24px;
      width: min(640px, calc(100% - 32px));
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.28);
      max-height: 90vh;
      overflow: auto;
    }

    .x-handle-product-modal__close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: #111827;
      color: #ffffff;
      font-size: 18px;
      cursor: pointer;
    }

    .x-handle-product-modal__title {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 22px;
      font-weight: 700;
    }

    .x-handle-product-modal__body {
      font-size: 16px;
      line-height: 1.6;
    }

    .x-handle-product-modal__spinner {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 4px solid rgba(17, 24, 39, 0.18);
      border-top-color: #111827;
      animation: x-modal-spin 900ms linear infinite;
      margin: 16px auto;
      display: none;
    }

    .x-handle-product-modal__spinner.is-active {
      display: block;
    }

    @keyframes x-modal-spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="x-handle-product-modal" data-handle-modal hidden>
    <div class="x-handle-product-modal__backdrop" data-handle-modal-close></div>

    <div class="x-handle-product-modal__dialog" role="dialog" aria-modal="true" aria-live="polite">
      <button
        type="button"
        class="x-handle-product-modal__close"
        data-handle-modal-close
        aria-label="Close"
      >
        ×
      </button>

      <h2 class="x-handle-product-modal__title" data-modal-title>Loading…</h2>
      <div class="x-handle-product-modal__spinner" data-modal-spinner aria-hidden="true"></div>
      <div class="x-handle-product-modal__body" data-modal-body>
        The product content will appear here once loaded.
      </div>
    </div>
  </div>

  <script>
    (function() {
      var modal = document.querySelector('[data-handle-modal]');
      if (!modal) return;

      var dialog = modal.querySelector('.x-handle-product-modal__dialog');
      var closeButtons = modal.querySelectorAll('[data-handle-modal-close]');
      var titleEl = modal.querySelector('[data-modal-title]');
      var bodyEl = modal.querySelector('[data-modal-body]');
      var spinner = modal.querySelector('[data-modal-spinner]');
      var openHandle = null;

      function lockScroll(lock) {
        document.body.style.overflow = lock ? 'hidden' : '';
      }

      function showSpinner(active) {
        if (!spinner) return;
        spinner.classList.toggle('is-active', Boolean(active));
      }

      function closeModal() {
        modal.classList.remove('is-open');
        modal.hidden = true;
        lockScroll(false);
        openHandle = null;
      }

      closeButtons.forEach(function(btn) {
        btn.addEventListener('click', function() {
          closeModal();
        });
      });

      document.addEventListener('keydown', function(evt) {
        if (evt.key === 'Escape' && modal.classList.contains('is-open')) {
          closeModal();
        }
      });

      document.addEventListener('handleProduct:open', function(event) {
        var handle = event.detail && event.detail.handle;
        if (!handle) return;

        openHandle = handle;
        titleEl.textContent = 'Product: ' + handle;
        bodyEl.textContent = 'Loading product content for "' + handle + '"…';
        showSpinner(true);

        modal.hidden = false;
        modal.classList.add('is-open');
        lockScroll(true);

        // Simulate async content load; replace with real fetch/render in production.
        setTimeout(function() {
          bodyEl.textContent = 'Here is the popup content for product handle "' + handle + '".';
          showSpinner(false);
          document.dispatchEvent(
            new CustomEvent('handleProduct:opened', {
              detail: { handle: handle },
              bubbles: true
            })
          );
        }, 600);
      });
    })();
  </script>
</body>
</html>
